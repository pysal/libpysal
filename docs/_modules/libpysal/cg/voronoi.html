<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>libpysal.cg.voronoi &#8212; libpysal v4.2.2 Manual</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/pysal-styles.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script src="../../../_static/js/jquery-fix.js"></script>
    <script src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/pysal_favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          libpysal</a>
        <span class="navbar-text navbar-version pull-left"><b>4.2.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../installation.html">Installation</a></li>
                <li><a href="../../../tutorial.html">Tutorial</a></li>
                <li><a href="../../../api.html">API</a></li>
                <li><a href="../../../references.html">References</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#installing-released-version">Installing released version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#installing-development-version">Installing development version</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/weights.html">Weights from GeoDataFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/weights.html#Weights-from-shapefiles-(without-geopandas)">Weights from shapefiles (without geopandas)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/weights.html#Lattice-Weights">Lattice Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/weights.html#Handling-nonplanar-geometries">Handling nonplanar geometries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/voronoi.html">Voronoi Polygons for 2-D Point Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/voronoi.html#Voronoi-Weights">Voronoi Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/examples.html">Datasets for use with libpysal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/examples.html#Backwards-compatibility-is-maintained">Backwards compatibility is maintained</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/examples.html#available-is-updated"><code class="docutils literal notranslate"><span class="pre">available</span></code> is updated</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/examples.html#Remote-datasets">Remote datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/examples.html#Other-Remotes">Other Remotes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/examples.html#Grabbing-all-the-remotes">Grabbing all the remotes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#spatial-weights">Spatial Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#cg-computational-geometry">cg: Computational Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#io">io</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Source code for libpysal.cg.voronoi</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Voronoi tesslation of 2-d point sets</span>


<span class="sd">Adapted from https://gist.github.com/pv/8036995</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">Voronoi</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Serge Rey &lt;sjsrey@gmail.com&gt;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;voronoi_frames&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">voronoi</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine finite Voronoi diagram for a 2-d point set </span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    points      : array-like</span>
<span class="sd">                  nx2 array of points</span>

<span class="sd">    radius      : float (optional) </span>
<span class="sd">                  distance to &#39;points at infinity&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    regions    : list</span>
<span class="sd">                  each element of the list contains sequence of the indexes of Voronoi vertices composing a Voronoi polygon (region)</span>

<span class="sd">    coordinates : array</span>
<span class="sd">                  coordinates of the Voronoi vertices</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; points = [(10.2, 5.1), (4.7, 2.2), (5.3, 5.7), (2.7, 5.3)]</span>
<span class="sd">    &gt;&gt;&gt; regions, coordinates = voronoi(points)</span>
<span class="sd">    &gt;&gt;&gt; regions</span>
<span class="sd">    [[1, 3, 2], [4, 5, 1, 0], [0, 1, 7, 6], [9, 0, 8]]</span>
<span class="sd">    &gt;&gt;&gt; coordinates</span>
<span class="sd">    array([[  4.21783296,   4.08408578],</span>
<span class="sd">           [  7.51956025,   3.51807539],</span>
<span class="sd">           [  9.4642193 ,  19.3994576 ],</span>
<span class="sd">           [ 14.98210684, -10.63503022],</span>
<span class="sd">           [ -9.22691341,  -4.58994414],</span>
<span class="sd">           [ 14.98210684, -10.63503022],</span>
<span class="sd">           [  1.78491801,  19.89803294],</span>
<span class="sd">           [  9.4642193 ,  19.3994576 ],</span>
<span class="sd">           [  1.78491801,  19.89803294],</span>
<span class="sd">           [ -9.22691341,  -4.58994414]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vor</span> <span class="o">=</span> <span class="n">Voronoi</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">voronoi_regions</span><span class="p">(</span><span class="n">vor</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">voronoi_regions</span><span class="p">(</span><span class="n">vor</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finite voronoi regions for a 2-d point set.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    vor:  Voronoi (scipy.spatial)</span>

<span class="sd">    radius: float (optional)</span>
<span class="sd">            Distance to &#39;points at infinity&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_regions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_vertices</span> <span class="o">=</span> <span class="n">vor</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">center</span> <span class="o">=</span> <span class="n">vor</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">vor</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="n">all_ridges</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">),</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vor</span><span class="o">.</span><span class="n">ridge_points</span><span class="p">,</span> <span class="n">vor</span><span class="o">.</span><span class="n">ridge_vertices</span><span class="p">):</span>
        <span class="n">all_ridges</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p2</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>
        <span class="n">all_ridges</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vor</span><span class="o">.</span><span class="n">point_region</span><span class="p">):</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">vor</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="n">region</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">):</span>
            <span class="n">new_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">ridges</span> <span class="o">=</span> <span class="n">all_ridges</span><span class="p">[</span><span class="n">p1</span><span class="p">]</span>
        <span class="n">new_region</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">p2</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">ridges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v1</span>
            <span class="k">if</span> <span class="n">v1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">t</span> <span class="o">=</span> <span class="n">vor</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">p2</span><span class="p">]</span> <span class="o">-</span> <span class="n">vor</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">p1</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">midpoint</span> <span class="o">=</span> <span class="n">vor</span><span class="o">.</span><span class="n">points</span><span class="p">[[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">midpoint</span> <span class="o">-</span> <span class="n">center</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">*</span> <span class="n">n</span>
            <span class="n">far_point</span> <span class="o">=</span> <span class="n">vor</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">radius</span>

            <span class="n">new_region</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">))</span>
            <span class="n">new_vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">far_point</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="n">vs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_region</span><span class="p">])</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">vs</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">vs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">new_region</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_region</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">angles</span><span class="p">)]</span>

        <span class="n">new_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_region</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">new_regions</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">as_dataframes</span><span class="p">(</span><span class="n">regions</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to store finite Voronoi regions and originator points as</span>
<span class="sd">    geopandas (or pandas) data frames</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    regions     : list</span>
<span class="sd">                  each element of the list contains sequence of the indexes of</span>
<span class="sd">                  voronoi vertices composing a vornoi polygon (region)</span>

<span class="sd">    vertices    : array</span>
<span class="sd">                  coordinates of the vornoi vertices</span>

<span class="sd">    points      : array-like</span>
<span class="sd">                  originator points</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    region_df   : GeoDataFrame</span>
<span class="sd">                  Finite Voronoi polygons as geometries</span>

<span class="sd">    points_df   : GeoDataFrame</span>
<span class="sd">                  Originator points as geometries</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">gpd</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Point</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.shapes</span> <span class="kn">import</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Point</span>

    <span class="k">if</span> <span class="n">gpd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">region_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">()</span>
        <span class="n">region_df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Polygon</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">region</span><span class="p">])</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span>
        <span class="p">]</span>

        <span class="n">point_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">()</span>
        <span class="n">point_df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">pnt</span><span class="p">)</span> <span class="k">for</span> <span class="n">pnt</span> <span class="ow">in</span> <span class="n">points</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="n">region_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">region_df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Polygon</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">region</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span>
        <span class="p">]</span>
        <span class="n">point_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">point_df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">pnt</span><span class="p">)</span> <span class="k">for</span> <span class="n">pnt</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">region_df</span><span class="p">,</span> <span class="n">point_df</span>


<div class="viewcode-block" id="voronoi_frames"><a class="viewcode-back" href="../../../generated/libpysal.cg.voronoi_frames.html#libpysal.cg.voronoi_frames">[docs]</a><span class="k">def</span> <span class="nf">voronoi_frames</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="s1">&#39;extent&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Composite helper to return Voronoi regions and generator points as individual dataframes</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    points      : array-like</span>
<span class="sd">                  originator points</span>

<span class="sd">    radius      : float</span>
<span class="sd">                  distance to &quot;points at infinity&quot; used in building voronoi cells</span>

<span class="sd">    clip        : str, or shapely.geometry.Polygon</span>
<span class="sd">                  an overloaded option about how to clip the voronoi</span>
<span class="sd">                  cells. The options are:</span>
<span class="sd">                  - &#39;none&#39;/None: no clip is applied. Voronoi cells may be arbitrarily larger that the source map. Note that this may lead to cells that are many orders of magnitude larger in extent than the original map. Not recommended.</span>
<span class="sd">                  - &#39;bbox&#39;/&#39;extent&#39;/&#39;bounding box&#39;: clip the voronoi cells to the bounding box of the input points.</span>
<span class="sd">                  - &#39;chull&#39;/&#39;convex hull&#39;: clip the voronoi cells to the convex hull of the input points.</span>
<span class="sd">                  - &#39;ashape&#39;/&#39;ahull&#39;: clip the voronoi cells to the tightest hull that contains all points (e.g. the smallest alphashape, using libpysal.cg.alpha_shape_auto)</span>
<span class="sd">                  - Polygon: clip to an arbitrary Polygon</span>

<span class="sd">    tolerance   : float</span>
<span class="sd">                  percent of map width to use to buffer the extent of the map, if clipping (default: .01, or 1 percent)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    _           : tuple</span>
<span class="sd">                  (region_df, points_df)</span>

<span class="sd">                  region_df   : GeoDataFrame (if geopandas available, otherwise Pandas DataFrame)</span>
<span class="sd">                                Finite Voronoi polygons as geometries</span>

<span class="sd">                  points_df   : GeoDataFrame (if geopandas available, otherwise Pandas DataFrame)</span>
<span class="sd">                                Originator points as geometries</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    If Geopandas is not available the return types will be Pandas DataFrames</span>
<span class="sd">    each with a geometry column populated with PySAL shapes. If Geopandas is</span>
<span class="sd">    available, return types are GeoDataFrames with a geometry column populated</span>
<span class="sd">    with shapely geometry types.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; points = [(10.2, 5.1), (4.7, 2.2), (5.3, 5.7), (2.7, 5.3)]</span>
<span class="sd">    &gt;&gt;&gt; regions_df, points_df = voronoi_frames(points)</span>
<span class="sd">    &gt;&gt;&gt; regions_df.shape</span>
<span class="sd">    (4, 1)</span>
<span class="sd">    &gt;&gt;&gt; regions_df.shape == points_df.shape</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">regions</span><span class="p">,</span> <span class="n">vertices</span> <span class="o">=</span> <span class="n">voronoi</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>
    <span class="n">regions</span><span class="p">,</span> <span class="n">vertices</span> <span class="o">=</span> <span class="n">as_dataframes</span><span class="p">(</span><span class="n">regions</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">clip</span><span class="p">:</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="n">clip_voronoi_frames_to_extent</span><span class="p">(</span><span class="n">regions</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="n">clip</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">regions</span><span class="p">,</span> <span class="n">vertices</span></div>


<span class="k">def</span> <span class="nf">clip_voronoi_frames_to_extent</span><span class="p">(</span><span class="n">regions</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="s1">&#39;extent&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    regions :   geopandas geodataframe</span>
<span class="sd">                dataframe containing voronoi cells to clip</span>
<span class="sd">    vertices:   geopandas geodataframe</span>
<span class="sd">                dataframe containing vertices used to build voronoi cells</span>
<span class="sd">    clip        : str, or shapely.geometry.Polygon</span>
<span class="sd">                  an overloaded option about how to clip the voronoi</span>
<span class="sd">                  cells. The options are:</span>
<span class="sd">                  - &#39;none&#39;/None: no clip is applied. Voronoi cells may be arbitrarily</span>
<span class="sd">                                 larger that the source map. Note that this may lead</span>
<span class="sd">                                 to cells that are many orders of magnitude larger</span>
<span class="sd">                                 in extent than the original map. Not recommended. </span>
<span class="sd">                  - &#39;bbox&#39;/&#39;extent&#39;/&#39;bounding box&#39;: clip the voronoi cells to the </span>
<span class="sd">                                                    bounding box of the input points.</span>
<span class="sd">                  - &#39;chull&#39;/&#39;convex hull&#39;: clip the voronoi cells to the convex hull</span>
<span class="sd">                                           of the input points.</span>
<span class="sd">                  - &#39;ashape&#39;/&#39;ahull&#39;: clip the voronoi cells to the tightest hull that</span>
<span class="sd">                                      contains all points (e.g. the smallest alphashape,</span>
<span class="sd">                                      using libpysal.cg.alpha_shape_auto)</span>
<span class="sd">                  - Polygon: clip to an arbitrary shapely.geometry.Polygon</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a geodataframe of clipped voronoi regions</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;shapely is required to clip voronoi regions&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">geopandas</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;geopandas is required to clip voronoi regions&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clip</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
        <span class="n">clipper</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">clip</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">clip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">regions</span>
    <span class="k">elif</span> <span class="n">clip</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">regions</span>
    <span class="k">elif</span> <span class="n">clip</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;bounds&#39;</span><span class="p">,</span> <span class="s1">&#39;bounding box&#39;</span><span class="p">,</span> <span class="s1">&#39;bbox&#39;</span><span class="p">,</span> <span class="s1">&#39;extent&#39;</span><span class="p">):</span>
        <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">total_bounds</span>
        <span class="n">bounding_poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">),</span> <span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">),</span> <span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">)])</span>
        <span class="n">clipper</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">bounding_poly</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">clip</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;chull&#39;</span><span class="p">,</span> <span class="s1">&#39;convex hull&#39;</span><span class="p">,</span> <span class="s1">&#39;convex_hull&#39;</span><span class="p">):</span>
        <span class="n">clipper</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">vertices</span><span class="o">.</span><span class="n">geometry</span>\
                                                           <span class="o">.</span><span class="n">unary_union</span>\
                                                           <span class="o">.</span><span class="n">convex_hull</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">clip</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ahull&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha hull&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_hull&#39;</span><span class="p">,</span> <span class="s1">&#39;ashape&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;alpha shape&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_shape&#39;</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.alpha_shapes</span> <span class="kn">import</span> <span class="n">alpha_shape_auto</span>
        <span class="kn">from</span> <span class="nn">..weights.distance</span> <span class="kn">import</span> <span class="n">get_points_array</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">get_points_array</span><span class="p">(</span><span class="n">vertices</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
        <span class="n">clipper</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
            <span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">alpha_shape_auto</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;clip type &quot;</span><span class="si">{}</span><span class="s1">&quot; not understood. Try one &#39;</span>
                         <span class="s1">&#39; of the supported options: [None, &quot;extent&quot;, &#39;</span>
                         <span class="s1">&#39;&quot;chull&quot;, &quot;ahull&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clip</span><span class="p">))</span>
    <span class="n">clipped_regions</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">regions</span><span class="p">,</span> <span class="n">clipper</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">clipped_regions</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2018-, pysal developers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>