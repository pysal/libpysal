<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>libpysal.weights.weights &#8212; libpysal v4.14.1 Manual</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-sphinx.css?v=9afac83c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/pysal-styles.css?v=38b0ce36" />
    <script src="../../../_static/documentation_options.js?v=2aa3d6d4"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../../../_static/pysal_favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          libpysal</a>
        <span class="navbar-text navbar-version pull-left"><b>4.14.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../installation.html">Installation</a></li>
                <li><a href="../../../user-guide/intro.html">User Guide</a></li>
                <li><a href="../../../api.html">API</a></li>
                <li><a href="../../../references.html">References</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#installing-released-version">Installing released version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#installing-development-version">Installing development version</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#spatial-graph">Spatial Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#spatial-weights">Spatial Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#cg-computational-geometry">cg: Computational Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#io">io</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#kernels">kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/intro.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/data/examples.html">Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/weights/intro.html">Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/graph/intro.html">Graphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/kernels.html">Kernels</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../migration.html">W to Graph Member Comparisions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../migration.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../migration.html#members-common-to-w-and-graph">Members common to W and Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../migration.html#members-common-to-w-and-graph-with-different-types">Members common to W and Graph with different types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../migration.html#members-unique-to-w">Members unique to W</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../migration.html#members-unique-to-graph">Members unique to Graph</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for libpysal.weights.weights</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Weights.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># ruff: noqa: N802, N803</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Sergio J. Rey &lt;srey@asu.edu&gt;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">basename</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.sparse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.sparse.csgraph</span><span class="w"> </span><span class="kn">import</span> <span class="n">connected_components</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..io.fileio</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileIO</span>

<span class="c1"># from .util import full, WSP2W resolve import cycle by</span>
<span class="c1"># forcing these into methods</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">adjtools</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;WSP&quot;</span><span class="p">]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_LabelEncoder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode labels with values between 0 and n_classes-1.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    classes_: array of shape [n_classes]</span>
<span class="sd">        Class labels for each index.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; le = _LabelEncoder()</span>
<span class="sd">    &gt;&gt;&gt; le.fit([&quot;NY&quot;, &quot;CA&quot;, &quot;NY&quot;, &quot;CA&quot;, &quot;TX&quot;, &quot;TX&quot;])</span>
<span class="sd">    &gt;&gt;&gt; le.classes_</span>
<span class="sd">    array([&#39;CA&#39;, &#39;NY&#39;, &#39;TX&#39;])</span>
<span class="sd">    &gt;&gt;&gt; le.transform([&quot;NY&quot;, &quot;CA&quot;, &quot;NY&quot;, &quot;CA&quot;, &quot;TX&quot;, &quot;TX&quot;])</span>
<span class="sd">    array([1, 0, 1, 0, 2, 2])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit label encoder.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y : list</span>
<span class="sd">            list of labels</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : instance of self.</span>
<span class="sd">          Fitted label encoder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform labels to normalized encoding.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y : list</span>
<span class="sd">            list of labels</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        y : array</span>
<span class="sd">            array of normalized labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


<div class="viewcode-block" id="W">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">W</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spatial weights class. Class attributes are described by their</span>
<span class="sd">    docstrings. to view, use the ``help`` function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    neighbors : dict</span>
<span class="sd">        Key is region ID, value is a list of neighbor IDS.</span>
<span class="sd">        For example, ``{&#39;a&#39;:[&#39;b&#39;],&#39;b&#39;:[&#39;a&#39;,&#39;c&#39;],&#39;c&#39;:[&#39;b&#39;]}``.</span>
<span class="sd">    weights : dict</span>
<span class="sd">       Key is region ID, value is a list of edge weights.</span>
<span class="sd">       If not supplied all edge weights are assumed to have a weight of 1.</span>
<span class="sd">       For example, ``{&#39;a&#39;:[0.5],&#39;b&#39;:[0.5,1.5],&#39;c&#39;:[1.5]}``.</span>
<span class="sd">    id_order : list</span>
<span class="sd">       An ordered list of ids, defines the order of observations when</span>
<span class="sd">       iterating over ``W`` if not set, lexicographical ordering is used</span>
<span class="sd">       to iterate and the ``id_order_set`` property will return ``False``.</span>
<span class="sd">       This can be set after creation by setting the ``id_order`` property.</span>
<span class="sd">    silence_warnings : bool</span>
<span class="sd">       By default ``libpysal`` will print a warning if the dataset contains</span>
<span class="sd">       any disconnected components or islands. To silence this warning set this</span>
<span class="sd">       parameter to ``True``.</span>
<span class="sd">    ids : list</span>
<span class="sd">        Values to use for keys of the neighbors and weights ``dict`` objects.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    asymmetries</span>
<span class="sd">    cardinalities</span>
<span class="sd">    component_labels</span>
<span class="sd">    diagW2</span>
<span class="sd">    diagWtW</span>
<span class="sd">    diagWtW_WW</span>
<span class="sd">    histogram</span>
<span class="sd">    id2i</span>
<span class="sd">    id_order</span>
<span class="sd">    id_order_set</span>
<span class="sd">    islands</span>
<span class="sd">    max_neighbors</span>
<span class="sd">    mean_neighbors</span>
<span class="sd">    min_neighbors</span>
<span class="sd">    n</span>
<span class="sd">    n_components</span>
<span class="sd">    neighbor_offsets</span>
<span class="sd">    nonzero</span>
<span class="sd">    pct_nonzero</span>
<span class="sd">    s0</span>
<span class="sd">    s1</span>
<span class="sd">    s2</span>
<span class="sd">    s2array</span>
<span class="sd">    sd</span>
<span class="sd">    sparse</span>
<span class="sd">    trcW2</span>
<span class="sd">    trcWtW</span>
<span class="sd">    trcWtW_WW</span>
<span class="sd">    transform</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from libpysal.weights import W</span>
<span class="sd">    &gt;&gt;&gt; neighbors = {0: [3, 1], 1: [0, 4, 2], 2: [1, 5], 3: [0, 6, 4], 4: [1, 3, 7, 5], 5: [2, 4, 8], 6: [3, 7], 7: [4, 6, 8], 8: [5, 7]}</span>
<span class="sd">    &gt;&gt;&gt; weights = {0: [1, 1], 1: [1, 1, 1], 2: [1, 1], 3: [1, 1, 1], 4: [1, 1, 1, 1], 5: [1, 1, 1], 6: [1, 1], 7: [1, 1, 1], 8: [1, 1]}</span>
<span class="sd">    &gt;&gt;&gt; w = W(neighbors, weights)</span>
<span class="sd">    &gt;&gt;&gt; &quot;%.3f&quot;%w.pct_nonzero</span>
<span class="sd">    &#39;29.630&#39;</span>

<span class="sd">    Read from external `.gal file &lt;https://geodacenter.github.io/workbook/4a_contig_weights/lab4a.html#gal-weights-file&gt;`_.</span>

<span class="sd">    &gt;&gt;&gt; import libpysal</span>
<span class="sd">    &gt;&gt;&gt; w = libpysal.io.open(libpysal.examples.get_path(&quot;stl.gal&quot;)).read()</span>
<span class="sd">    &gt;&gt;&gt; w.n</span>
<span class="sd">    78</span>
<span class="sd">    &gt;&gt;&gt; &quot;%.3f&quot;%w.pct_nonzero</span>
<span class="sd">    &#39;6.542&#39;</span>

<span class="sd">    Set weights implicitly.</span>

<span class="sd">    &gt;&gt;&gt; neighbors = {0: [3, 1], 1: [0, 4, 2], 2: [1, 5], 3: [0, 6, 4], 4: [1, 3, 7, 5], 5: [2, 4, 8], 6: [3, 7], 7: [4, 6, 8], 8: [5, 7]}</span>
<span class="sd">    &gt;&gt;&gt; w = W(neighbors)</span>
<span class="sd">    &gt;&gt;&gt; round(w.pct_nonzero,3)</span>
<span class="sd">    29.63</span>
<span class="sd">    &gt;&gt;&gt; from libpysal.weights import lat2W</span>
<span class="sd">    &gt;&gt;&gt; w = lat2W(100, 100)</span>
<span class="sd">    &gt;&gt;&gt; w.trcW2</span>
<span class="sd">    39600.0</span>
<span class="sd">    &gt;&gt;&gt; w.trcWtW</span>
<span class="sd">    39600.0</span>
<span class="sd">    &gt;&gt;&gt; w.transform=&#39;r&#39;</span>
<span class="sd">    &gt;&gt;&gt; round(w.trcW2, 3)</span>
<span class="sd">    2530.722</span>
<span class="sd">    &gt;&gt;&gt; round(w.trcWtW, 3)</span>
<span class="sd">    2533.667</span>

<span class="sd">    Cardinality Histogram:</span>

<span class="sd">    &gt;&gt;&gt; w.histogram</span>
<span class="sd">    [(2, 4), (3, 392), (4, 9604)]</span>

<span class="sd">    Disconnected observations (islands):</span>

<span class="sd">    &gt;&gt;&gt; from libpysal.weights import W</span>
<span class="sd">    &gt;&gt;&gt; w = W({1:[0],0:[1],2:[], 3:[]})</span>

<span class="sd">    UserWarning: The weights matrix is not fully connected:</span>
<span class="sd">    There are 3 disconnected components.</span>
<span class="sd">    There are 2 islands with ids: 2, 3.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>

<div class="viewcode-block" id="W.__init__">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">neighbors</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">id_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">silence_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: ARG002</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">silence_warnings</span> <span class="o">=</span> <span class="n">silence_warnings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="n">neighbors</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">weights</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
                <span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># original weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="s2">&quot;O&quot;</span>
        <span class="k">if</span> <span class="n">id_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_id_order_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span> <span class="o">=</span> <span class="n">id_order</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_id_order_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silence_warnings</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;The weights matrix is not fully connected: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> There are </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="si">}</span><span class="s2"> disconnected components.&quot;</span>
            <span class="p">)</span>
            <span class="n">ni</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">islands</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ni</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">message</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> There is 1 island with id: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">islands</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">ni</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">iids</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">island</span><span class="p">)</span> <span class="k">for</span> <span class="n">island</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">islands</span><span class="p">)</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">message</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> There are </span><span class="si">{</span><span class="n">ni</span><span class="si">}</span><span class="s2"> islands with ids: </span><span class="si">{</span><span class="n">iids</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset properties.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="W.to_file">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.to_file">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># noqa: A002</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a weights to a file. The format is guessed automatically</span>
<span class="sd">        from the path, but can be overridden with the format argument.</span>

<span class="sd">        See libpysal.io.FileIO for more information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path    :   string</span>
<span class="sd">                    location to save the file</span>
<span class="sd">        format  :   string</span>
<span class="sd">                    string denoting the format to write the weights to.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">(</span><span class="n">dataPath</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">dataFormat</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="W.from_file">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.from_file">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># noqa: A002</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a weights file into a W object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path    :   string</span>
<span class="sd">                    location to save the file</span>
<span class="sd">        format  :   string</span>
<span class="sd">                    string denoting the format to write the weights to.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        W object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">(</span><span class="n">dataPath</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">dataFormat</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">w</span></div>


<div class="viewcode-block" id="W.from_shapefile">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.from_shapefile">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_shapefile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># we could also just &quot;do the right thing,&quot; but I think it&#39;d make sense to</span>
        <span class="c1"># try and get people to use `Rook.from_shapefile(shapefile)` rather than</span>
        <span class="c1"># W.from_shapefile(shapefile, type=`rook`), otherwise we&#39;d need to build</span>
        <span class="c1"># a type dispatch table. Generic W should be for stuff we don&#39;t know</span>
        <span class="c1"># anything about.</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Use type-specific constructors, like Rook, Queen, DistanceBand, or Kernel&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="W.from_WSP">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.from_WSP">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_WSP</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">WSP</span><span class="p">,</span> <span class="n">silence_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a pysal W from a pysal WSP object (thin weights matrix).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wsp                     : WSP</span>
<span class="sd">                                PySAL sparse weights object</span>
<span class="sd">        silence_warnings        : bool</span>
<span class="sd">           By default ``libpysal`` will print a warning if the dataset contains</span>
<span class="sd">           any disconnected components or islands. To silence this warning set this</span>
<span class="sd">           parameter to ``True``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        w       : W</span>
<span class="sd">                PySAL weights object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import lat2W, WSP, W</span>

<span class="sd">        Build a 10x10 scipy.sparse matrix for a rectangular 2x5 region of cells</span>
<span class="sd">        (rook contiguity), then construct a PySAL sparse weights object (wsp).</span>

<span class="sd">        &gt;&gt;&gt; sp = lat2SW(2, 5)</span>
<span class="sd">        &gt;&gt;&gt; wsp = WSP(sp)</span>
<span class="sd">        &gt;&gt;&gt; wsp.n</span>
<span class="sd">        10</span>
<span class="sd">        &gt;&gt;&gt; wsp.sparse[0].todense()</span>
<span class="sd">        matrix([[0, 1, 0, 0, 0, 1, 0, 0, 0, 0]], dtype=int8)</span>

<span class="sd">        Create a standard PySAL W from this sparse weights object.</span>

<span class="sd">        &gt;&gt;&gt; w = W.from_WSP(wsp)</span>
<span class="sd">        &gt;&gt;&gt; w.n</span>
<span class="sd">        10</span>
<span class="sd">        &gt;&gt;&gt; print(w.full()[0][0])</span>
<span class="sd">        [0 1 0 0 0 1 0 0 0 0]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">WSP</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">data</span>
        <span class="n">indptr</span> <span class="o">=</span> <span class="n">WSP</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">indptr</span>
        <span class="n">id_order</span> <span class="o">=</span> <span class="n">WSP</span><span class="o">.</span><span class="n">id_order</span>
        <span class="k">if</span> <span class="n">id_order</span><span class="p">:</span>
            <span class="c1"># replace indices with user IDs</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_order</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">WSP</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">id_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">WSP</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="n">neighbors</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">indptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">WSP</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="n">oid</span> <span class="o">=</span> <span class="n">id_order</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">indptr</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">neighbors</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="n">weights</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">end</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">WSP</span><span class="o">.</span><span class="n">id_order</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">W</span><span class="p">(</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">silence_warnings</span><span class="o">=</span><span class="n">silence_warnings</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">_sparse</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">WSP</span><span class="o">.</span><span class="n">sparse</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;sparse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">_sparse</span>
        <span class="k">return</span> <span class="n">w</span></div>


<div class="viewcode-block" id="W.from_adjlist">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.from_adjlist">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_adjlist</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">adjlist</span><span class="p">,</span> <span class="n">focal_col</span><span class="o">=</span><span class="s2">&quot;focal&quot;</span><span class="p">,</span> <span class="n">neighbor_col</span><span class="o">=</span><span class="s2">&quot;neighbor&quot;</span><span class="p">,</span> <span class="n">weight_col</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an adjacency list representation of a weights object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        adjlist : pandas.DataFrame</span>
<span class="sd">            Adjacency list with a minimum of two columns.</span>
<span class="sd">        focal_col : str</span>
<span class="sd">            Name of the column with the &quot;source&quot; node ids.</span>
<span class="sd">        neighbor_col : str</span>
<span class="sd">            Name of the column with the &quot;destination&quot; node ids.</span>
<span class="sd">        weight_col : str</span>
<span class="sd">            Name of the column with the weight information. If not provided and</span>
<span class="sd">            the dataframe has no column named &quot;weight&quot; then all weights</span>
<span class="sd">            are assumed to be 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">weight_col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weight_col</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span>
        <span class="n">try_weightcol</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">adjlist</span><span class="p">,</span> <span class="n">weight_col</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">try_weightcol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">adjlist</span> <span class="o">=</span> <span class="n">adjlist</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">adjlist</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">grouper</span> <span class="o">=</span> <span class="n">adjlist</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">focal_col</span><span class="p">)</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">grouper</span><span class="p">:</span>
            <span class="n">neighbors_to_ix</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">neighbor_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">weights_to_ix</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">weight_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">neighbors_to_ix</span> <span class="o">!=</span> <span class="n">ix</span>
            <span class="n">neighbors</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">neighbors_to_ix</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">weights</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights_to_ix</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">neighbors</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span></div>


<div class="viewcode-block" id="W.to_adjlist">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.to_adjlist">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_adjlist</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">remove_symmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">drop_islands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">focal_col</span><span class="o">=</span><span class="s2">&quot;focal&quot;</span><span class="p">,</span>
        <span class="n">neighbor_col</span><span class="o">=</span><span class="s2">&quot;neighbor&quot;</span><span class="p">,</span>
        <span class="n">weight_col</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span>
        <span class="n">sort_joins</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute an adjacency list representation of a weights object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        remove_symmetric : bool</span>
<span class="sd">            Whether or not to remove symmetric entries. If the ``W``</span>
<span class="sd">            is symmetric, a standard directed adjacency list will contain</span>
<span class="sd">            both the forward and backward links by default because adjacency</span>
<span class="sd">            lists are a directed graph representation. If this is ``True``,</span>
<span class="sd">            a ``W`` created from this adjacency list **MAY NOT BE THE SAME**</span>
<span class="sd">            as the original ``W``. If you would like to consider (1,2) and</span>
<span class="sd">            (2,1) as distinct links, leave this as ``False``.</span>
<span class="sd">        drop_islands : bool</span>
<span class="sd">            Whether or not to preserve islands as entries in the adjacency</span>
<span class="sd">            list. By default, observations with no neighbors do not appear</span>
<span class="sd">            in the adjacency list. If islands are kept, they are coded as</span>
<span class="sd">            self-neighbors with zero weight.</span>
<span class="sd">        focal_col : str</span>
<span class="sd">            Name of the column in which to store &quot;source&quot; node ids.</span>
<span class="sd">        neighbor_col : str</span>
<span class="sd">            Name of the column in which to store &quot;destination&quot; node ids.</span>
<span class="sd">        weight_col : str</span>
<span class="sd">            Name of the column in which to store weight information.</span>
<span class="sd">        sort_joins : bool</span>
<span class="sd">            Whether or not to lexicographically sort the adjacency</span>
<span class="sd">            list by (focal_col, neighbor_col). Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">ModuleNotFoundError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;pandas must be installed &amp; importable to use this method&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">drop_islands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">silence_warnings</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;In the next version of libpysal, observations with no neighbors &quot;</span>
                    <span class="s2">&quot;will be included in adjacency lists as loops (row with the same &quot;</span>
                    <span class="s2">&quot;focal and neighbor) with zero weight. In the current version, &quot;</span>
                    <span class="s2">&quot;observations with no neighbors are dropped. If you would like to &quot;</span>
                    <span class="s2">&quot;keep the current behavior, use drop_islands=True in this function&quot;</span>
                <span class="p">),</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">drop_islands</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">focal_ix</span><span class="p">,</span> <span class="n">neighbor_ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_order</span><span class="p">)</span>
        <span class="n">focal_ix</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="n">focal_ix</span><span class="p">]</span>
        <span class="n">neighbor_ix</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="n">neighbor_ix</span><span class="p">]</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">data</span>
        <span class="n">adjlist</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="n">focal_col</span><span class="p">:</span> <span class="n">focal_ix</span><span class="p">,</span> <span class="n">neighbor_col</span><span class="p">:</span> <span class="n">neighbor_ix</span><span class="p">,</span> <span class="n">weight_col</span><span class="p">:</span> <span class="n">weights</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">remove_symmetric</span><span class="p">:</span>
            <span class="n">adjlist</span> <span class="o">=</span> <span class="n">adjtools</span><span class="o">.</span><span class="n">filter_adjlist</span><span class="p">(</span><span class="n">adjlist</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">drop_islands</span><span class="p">:</span>
            <span class="n">island_adjlist</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span><span class="n">focal_col</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">islands</span><span class="p">,</span> <span class="n">neighbor_col</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">islands</span><span class="p">,</span> <span class="n">weight_col</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">adjlist</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">adjlist</span><span class="p">,</span> <span class="n">island_adjlist</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sort_joins</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">adjlist</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="n">focal_col</span><span class="p">,</span> <span class="n">neighbor_col</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">adjlist</span></div>


<div class="viewcode-block" id="W.to_networkx">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.to_networkx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_networkx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a weights object to a ``networkx`` graph.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A ``networkx`` graph representation of the ``W`` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;NetworkX 2.7+ is required to use this function.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">asymmetries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_scipy_sparse_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">,</span> <span class="n">create_using</span><span class="o">=</span><span class="n">g</span><span class="p">)</span></div>


<div class="viewcode-block" id="W.from_networkx">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.from_networkx">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_networkx</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">weight_col</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">):</span>  <span class="c1"># noqa: ARG003</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a ``networkx`` graph to a PySAL ``W`` object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph : networkx.Graph</span>
<span class="sd">            The graph to convert to a ``W``.</span>
<span class="sd">        weight_col : string</span>
<span class="sd">            If the graph is labeled, this should be the name of the field</span>
<span class="sd">            to use as the weight for the ``W``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        w : libpysal.weights.W</span>
<span class="sd">            A ``W`` object containing the same graph as the ``networkx`` graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;NetworkX 2.7+ is required to use this function.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
        <span class="n">sparse_array</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">to_scipy_sparse_array</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">WSP</span><span class="p">(</span><span class="n">sparse_array</span><span class="p">)</span><span class="o">.</span><span class="n">to_W</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">w</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sparse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sparse matrix object. For any matrix manipulations required for w,</span>
<span class="sd">        ``w.sparse`` should be used. This is based on ``scipy.sparse``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;sparse&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sparse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_sparse</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;sparse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sparse</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sparse</span>

<div class="viewcode-block" id="W.from_sparse">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.from_sparse">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_sparse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sparse</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a ``scipy.sparse`` array to a PySAL ``W`` object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sparse : scipy.sparse array</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        w : libpysal.weights.W</span>
<span class="sd">            A ``W`` object containing the same graph as the ``scipy.sparse`` graph.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        When the sparse array has a zero in its data attribute, and</span>
<span class="sd">        the corresponding row and column values are equal, the value</span>
<span class="sd">        for the pysal weight will be 0 for the &quot;loop&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coo</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">tocoo</span><span class="p">()</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coo</span><span class="o">.</span><span class="n">row</span><span class="p">,</span> <span class="n">coo</span><span class="o">.</span><span class="n">col</span><span class="p">,</span> <span class="n">coo</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">neighbors</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">weights</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">W</span><span class="p">(</span><span class="n">neighbors</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span></div>


<div class="viewcode-block" id="W.to_sparse">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.to_sparse">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_sparse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;coo&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a ``scipy.sparse`` array object from a pysal W.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fmt : {&#39;bsr&#39;, &#39;coo&#39;, &#39;csc&#39;, &#39;csr&#39;}</span>
<span class="sd">          scipy.sparse format</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        scipy.sparse array</span>
<span class="sd">          A scipy.sparse array with a format of fmt.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The keys of the w.neighbors are encoded</span>
<span class="sd">        to determine row,col in the sparse array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">disp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">disp</span><span class="p">[</span><span class="s2">&quot;bsr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">bsr_array</span>
        <span class="n">disp</span><span class="p">[</span><span class="s2">&quot;coo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_array</span>
        <span class="n">disp</span><span class="p">[</span><span class="s2">&quot;csc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csc_array</span>
        <span class="n">disp</span><span class="p">[</span><span class="s2">&quot;csr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_array</span>
        <span class="n">fmt_l</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fmt_l</span> <span class="ow">in</span> <span class="n">disp</span><span class="p">:</span>
            <span class="n">adj_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_adjlist</span><span class="p">(</span><span class="n">drop_islands</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">adj_list</span><span class="o">.</span><span class="n">weight</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">adj_list</span><span class="o">.</span><span class="n">focal</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">adj_list</span><span class="o">.</span><span class="n">neighbor</span>
            <span class="n">le</span> <span class="o">=</span> <span class="n">_LabelEncoder</span><span class="p">()</span>
            <span class="n">le</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
            <span class="k">return</span> <span class="n">disp</span><span class="p">[</span><span class="n">fmt_l</span><span class="p">]((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsupported sparse format: </span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store whether the adjacency matrix is fully connected.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;n_components&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_components</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_labels</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;n_components&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_components</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;component_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_labels</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_components</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">component_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store the graph component in which each observation falls.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;component_labels&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_components</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_labels</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;n_components&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_components</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;component_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_labels</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_sparse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct the sparse attribute.&quot;&quot;&quot;</span>

        <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">col</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">id2i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id2i</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">neigh_list</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbor_offsets</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cardinalities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">row</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">id2i</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">card</span><span class="p">)</span>
            <span class="n">col</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">neigh_list</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">id2i</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dictionary where the key is an ID and the value is that ID&#39;s</span>
<span class="sd">        index in ``W.id_order``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;id2i&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_id2i</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">id_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_id2i</span><span class="p">[</span><span class="n">id_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_id2i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id2i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;id2i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id2i</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id2i</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of units.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;n&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;``s0`` is defined as</span>

<span class="sd">        .. math::</span>

<span class="sd">               s0=\sum_i \sum_j w_{i,j}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;s0&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;s0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s0</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;``s1`` is defined as</span>

<span class="sd">        .. math::</span>

<span class="sd">               s1=1/2 \sum_i \sum_j \Big(w_{i,j} + w_{j,i}\Big)^2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;s1&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># element-wise square</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s1</span> <span class="o">=</span> <span class="n">t2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;s1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s1</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s2array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Individual elements comprising ``s2``.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        s2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;s2array&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s2array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;s2array&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s2array</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s2array</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;``s2`` is defined as</span>

<span class="sd">        .. math::</span>

<span class="sd">                s2=\sum_j \Big(\sum_i w_{i,j} + \sum_i w_{j,i}\Big)^2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;s2&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2array</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;s2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s2</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">trcW2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trace of :math:`WW`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        diagW2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;trcW2&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trcW2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diagW2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;trcw2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trcW2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trcW2</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">diagW2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Diagonal of :math:`WW`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        trcW2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;diagw2&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_diagW2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">)</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;diagW2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diagW2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diagW2</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">diagWtW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Diagonal of :math:`W^{&#39;}W`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        trcWtW</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;diagWtW&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_diagWtW</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">)</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;diagWtW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diagWtW</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diagWtW</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">trcWtW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trace of :math:`W^{&#39;}W`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        diagWtW</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;trcWtW&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trcWtW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diagWtW</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;trcWtW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trcWtW</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trcWtW</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">diagWtW_WW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Diagonal of :math:`W^{&#39;}W + WW`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;diagWtW_WW&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="n">wt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_diagWtW_WW</span> <span class="o">=</span> <span class="p">(</span><span class="n">wt</span> <span class="o">@</span> <span class="n">w</span> <span class="o">+</span> <span class="n">w</span> <span class="o">@</span> <span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;diagWtW_WW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diagWtW_WW</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diagWtW_WW</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">trcWtW_WW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trace of :math:`W^{&#39;}W + WW`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;trcWtW_WW&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trcWtW_WW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diagWtW_WW</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;trcWtW_WW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trcWtW_WW</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trcWtW_WW</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pct_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Percentage of nonzero weights.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;pct_nonzero&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pct_nonzero</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">nnz</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;pct_nonzero&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pct_nonzero</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pct_nonzero</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cardinalities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of neighbors for each observation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;cardinalities&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span><span class="p">:</span>
                <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cardinalities</span> <span class="o">=</span> <span class="n">c</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;cardinalities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cardinalities</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cardinalities</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Largest number of neighbors.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;max_neighbors&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_neighbors</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cardinalities</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;max_neighbors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_neighbors</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_neighbors</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mean_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Average number of neighbors.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;mean_neighbors&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mean_neighbors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cardinalities</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;mean_neighbors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_neighbors</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_neighbors</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">min_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Minimum number of neighbors.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;min_neighbors&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_min_neighbors</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cardinalities</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;min_neighbors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_neighbors</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_neighbors</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of nonzero weights.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;nonzero&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nonzero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">nnz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;nonzero&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonzero</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonzero</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Standard deviation of number of neighbors.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;sd&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cardinalities</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;sd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sd</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sd</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">asymmetries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of id pairs with asymmetric weights</span>
<span class="sd">        sorted in ascending *index location* order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;asymmetries&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_asymmetries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asymmetry</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;asymmetries&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asymmetries</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asymmetries</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">islands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of ids without any neighbors.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;islands&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_islands</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cardinalities</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;islands&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_islands</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_islands</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cardinality histogram as a dictionary where key is the id and</span>
<span class="sd">        value is the number of neighbors for that unit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;histogram&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="n">ct</span><span class="p">,</span> <span class="n">bin_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cardinalities</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_neighbors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_neighbors</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_histogram</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bin_</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ct</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;histogram&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_histogram</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_histogram</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allow a dictionary like interaction with the weights class.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import lat2W</span>
<span class="sd">        &gt;&gt;&gt; w = lat2W()</span>

<span class="sd">        &gt;&gt;&gt; w[0] == dict({1: 1.0, 5: 1.0})</span>
<span class="sd">        True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Support iteration over weights.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import lat2W</span>
<span class="sd">        &gt;&gt;&gt; w=lat2W(3,3)</span>
<span class="sd">        &gt;&gt;&gt; for i,wi in enumerate(w):</span>
<span class="sd">        ...     print(i,wi[0])</span>
<span class="sd">        ...</span>
<span class="sd">        0 0</span>
<span class="sd">        1 1</span>
<span class="sd">        2 2</span>
<span class="sd">        3 3</span>
<span class="sd">        4 4</span>
<span class="sd">        5 5</span>
<span class="sd">        6 6</span>
<span class="sd">        7 7</span>
<span class="sd">        8 8</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span>

<div class="viewcode-block" id="W.remap_ids">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.remap_ids">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remap_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In place modification throughout ``W`` of id values from</span>
<span class="sd">        ``w.id_order`` to ``new_ids`` in all.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_ids : list, numpy.ndarray</span>
<span class="sd">            Aligned list of new ids to be inserted. Note that first</span>
<span class="sd">            element of ``new_ids`` will replace first element of</span>
<span class="sd">            ``w.id_order``, second element of ``new_ids`` replaces second</span>
<span class="sd">            element of ``w.id_order`` and so on.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import lat2W</span>
<span class="sd">        &gt;&gt;&gt; w = lat2W(3, 3)</span>
<span class="sd">        &gt;&gt;&gt; w.id_order</span>
<span class="sd">        [0, 1, 2, 3, 4, 5, 6, 7, 8]</span>
<span class="sd">        &gt;&gt;&gt; w.neighbors[0]</span>
<span class="sd">        [3, 1]</span>
<span class="sd">        &gt;&gt;&gt; new_ids = [&#39;id%i&#39;%id for id in w.id_order]</span>
<span class="sd">        &gt;&gt;&gt; _ = w.remap_ids(new_ids)</span>
<span class="sd">        &gt;&gt;&gt; w.id_order</span>
<span class="sd">        [&#39;id0&#39;, &#39;id1&#39;, &#39;id2&#39;, &#39;id3&#39;, &#39;id4&#39;, &#39;id5&#39;, &#39;id6&#39;, &#39;id7&#39;, &#39;id8&#39;]</span>
<span class="sd">        &gt;&gt;&gt; w.neighbors[&#39;id0&#39;]</span>
<span class="sd">        [&#39;id3&#39;, &#39;id1&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">old_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_ids</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;W.remap_ids: length of `old_ids` does not match             that of&quot;</span>
                <span class="s2">&quot; new_ids&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_ids</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_ids</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;W.remap_ids: list `new_ids` contains duplicates&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_neighbors</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">new_weights</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">old_transformations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">new_transformations</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">old_ids</span><span class="p">,</span> <span class="n">new_ids</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">o_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>
                <span class="n">o_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>
                <span class="n">n_neighbors</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_ids</span><span class="p">[</span><span class="n">old_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">o_neighbors</span><span class="p">]</span>
                <span class="n">new_neighbors</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_neighbors</span>
                <span class="n">new_weights</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">o_weights</span><span class="p">[:]</span>
                <span class="n">new_transformations</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_transformations</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="n">new_neighbors</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">new_weights</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_transformations</span>

            <span class="n">id_order</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">old_ids</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">id_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">id_order</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id_order</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">__set_id_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ordered_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the iteration order in w. ``W`` can be iterated over. On</span>
<span class="sd">        construction the iteration order is set to the lexicographic order of</span>
<span class="sd">        the keys in the ``w.weights`` dictionary. If a specific order</span>
<span class="sd">        is required it can be set with this method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ordered_ids : sequence</span>
<span class="sd">            Identifiers for observations in specified order.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The ``ordered_ids`` parameter is checked against the ids implied</span>
<span class="sd">        by the keys in ``w.weights``. If they are not equivalent sets an</span>
<span class="sd">        exception is raised and the iteration order is not changed.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import lat2W</span>
<span class="sd">        &gt;&gt;&gt; w=lat2W(3,3)</span>
<span class="sd">        &gt;&gt;&gt; for i,wi in enumerate(w):</span>
<span class="sd">        ...     print(i, wi[0])</span>
<span class="sd">        ...</span>
<span class="sd">        0 0</span>
<span class="sd">        1 1</span>
<span class="sd">        2 2</span>
<span class="sd">        3 3</span>
<span class="sd">        4 4</span>
<span class="sd">        5 5</span>
<span class="sd">        6 6</span>
<span class="sd">        7 7</span>
<span class="sd">        8 8</span>
<span class="sd">        &gt;&gt;&gt; w.id_order</span>
<span class="sd">        [0, 1, 2, 3, 4, 5, 6, 7, 8]</span>
<span class="sd">        &gt;&gt;&gt; w.id_order=range(8,-1,-1)</span>
<span class="sd">        &gt;&gt;&gt; list(w.id_order)</span>
<span class="sd">        [8, 7, 6, 5, 4, 3, 2, 1, 0]</span>
<span class="sd">        &gt;&gt;&gt; for i,w_i in enumerate(w):</span>
<span class="sd">        ...     print(i,w_i[0])</span>
<span class="sd">        ...</span>
<span class="sd">        0 8</span>
<span class="sd">        1 7</span>
<span class="sd">        2 6</span>
<span class="sd">        3 5</span>
<span class="sd">        4 4</span>
<span class="sd">        5 3</span>
<span class="sd">        6 2</span>
<span class="sd">        7 1</span>
<span class="sd">        8 0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">ordered_ids</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span> <span class="o">=</span> <span class="n">ordered_ids</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_id_order_set</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ordered_ids do not align with W ids&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__get_id_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the ids for the observations in the order in which they</span>
<span class="sd">        would be encountered if iterating over the weights.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span>

    <span class="n">id_order</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">__get_id_order</span><span class="p">,</span> <span class="n">__set_id_order</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">id_order_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns ``True`` if user has set ``id_order``, ``False`` if not.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import lat2W</span>
<span class="sd">        &gt;&gt;&gt; w=lat2W()</span>
<span class="sd">        &gt;&gt;&gt; w.id_order_set</span>
<span class="sd">        True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_order_set</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">neighbor_offsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the current ``id_order``, ``neighbor_offsets[id]`` is the</span>
<span class="sd">        offsets of the id&#39;s neighbors in ``id_order``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        neighbor_list : list</span>
<span class="sd">            Offsets of the id&#39;s neighbors in ``id_order``.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import W</span>
<span class="sd">        &gt;&gt;&gt; neighbors={&#39;c&#39;: [&#39;b&#39;], &#39;b&#39;: [&#39;c&#39;, &#39;a&#39;], &#39;a&#39;: [&#39;b&#39;]}</span>
<span class="sd">        &gt;&gt;&gt; weights ={&#39;c&#39;: [1.0], &#39;b&#39;: [1.0, 1.0], &#39;a&#39;: [1.0]}</span>
<span class="sd">        &gt;&gt;&gt; w=W(neighbors,weights)</span>
<span class="sd">        &gt;&gt;&gt; w.id_order = [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]</span>
<span class="sd">        &gt;&gt;&gt; w.neighbor_offsets[&#39;b&#39;]</span>
<span class="sd">        [2, 0]</span>
<span class="sd">        &gt;&gt;&gt; w.id_order = [&#39;b&#39;,&#39;a&#39;,&#39;c&#39;]</span>
<span class="sd">        &gt;&gt;&gt; w.neighbor_offsets[&#39;b&#39;]</span>
<span class="sd">        [2, 1]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;neighbors_0&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__neighbors_0</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">id2i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id2i</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">neigh_list</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__neighbors_0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">id2i</span><span class="p">[</span><span class="n">neigh</span><span class="p">]</span> <span class="k">for</span> <span class="n">neigh</span> <span class="ow">in</span> <span class="n">neigh_list</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;neighbors_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__neighbors_0</span>

        <span class="n">neighbor_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__neighbors_0</span>

        <span class="k">return</span> <span class="n">neighbor_list</span>

<div class="viewcode-block" id="W.get_transform">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.get_transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Getter for transform property.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        transformation : str, None</span>
<span class="sd">            Valid transformation value. See the ``transform``</span>
<span class="sd">            parameters in ``set_transform()`` for a detailed description.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import lat2W</span>
<span class="sd">        &gt;&gt;&gt; w=lat2W()</span>
<span class="sd">        &gt;&gt;&gt; w.weights[0]</span>
<span class="sd">        [1.0, 1.0]</span>
<span class="sd">        &gt;&gt;&gt; w.transform</span>
<span class="sd">        &#39;O&#39;</span>
<span class="sd">        &gt;&gt;&gt; w.transform=&#39;r&#39;</span>
<span class="sd">        &gt;&gt;&gt; w.weights[0]</span>
<span class="sd">        [0.5, 0.5]</span>
<span class="sd">        &gt;&gt;&gt; w.transform=&#39;b&#39;</span>
<span class="sd">        &gt;&gt;&gt; w.weights[0]</span>
<span class="sd">        [1.0, 1.0]</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        set_transform</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span></div>


<div class="viewcode-block" id="W.set_transform">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.set_transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transformations of weights.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        transform : str</span>
<span class="sd">            This parameter is not case sensitive. The following are</span>
<span class="sd">            valid transformations.</span>

<span class="sd">            * **B** -- Binary</span>
<span class="sd">            * **R** -- Row-standardization (global sum :math:`=n`)</span>
<span class="sd">            * **D** -- Double-standardization (global sum :math:`=1`)</span>
<span class="sd">            * **V** -- Variance stabilizing</span>
<span class="sd">            * **O** -- Restore original transformation (from instantiation)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Transformations are applied only to the value of the weights at</span>
<span class="sd">        instantiation. Chaining of transformations cannot be done on a ``W``</span>
<span class="sd">        instance.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import lat2W</span>
<span class="sd">        &gt;&gt;&gt; w=lat2W()</span>
<span class="sd">        &gt;&gt;&gt; w.weights[0]</span>
<span class="sd">        [1.0, 1.0]</span>
<span class="sd">        &gt;&gt;&gt; w.transform</span>
<span class="sd">        &#39;O&#39;</span>
<span class="sd">        &gt;&gt;&gt; w.transform=&#39;r&#39;</span>
<span class="sd">        &gt;&gt;&gt; w.weights[0]</span>
<span class="sd">        [0.5, 0.5]</span>
<span class="sd">        &gt;&gt;&gt; w.transform=&#39;b&#39;</span>
<span class="sd">        &gt;&gt;&gt; w.weights[0]</span>
<span class="sd">        [1.0, 1.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span>
                <span class="c1"># row standardized weights</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
                    <span class="n">wijs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">row_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">wijs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span>
                    <span class="k">if</span> <span class="n">row_sum</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silence_warnings</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;WARNING: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot; is an island (no neighbors)&quot;</span><span class="p">))</span>
                    <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wij</span> <span class="o">/</span> <span class="n">row_sum</span> <span class="k">for</span> <span class="n">wij</span> <span class="ow">in</span> <span class="n">wijs</span><span class="p">]</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;D&quot;</span><span class="p">:</span>
                <span class="c1"># doubly-standardized weights</span>
                <span class="c1"># update current chars before doing global sum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
                <span class="n">s0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s0</span>
                <span class="n">ws</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">s0</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
                    <span class="n">wijs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wij</span> <span class="o">*</span> <span class="n">ws</span> <span class="k">for</span> <span class="n">wij</span> <span class="ow">in</span> <span class="n">wijs</span><span class="p">]</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span>
                <span class="c1"># binary transformation</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
                    <span class="n">wijs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">wij</span> <span class="ow">in</span> <span class="n">wijs</span><span class="p">]</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;V&quot;</span><span class="p">:</span>
                <span class="c1"># variance stabilizing</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">q</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">s</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">big_q</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
                    <span class="n">wijs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">wij</span> <span class="o">*</span> <span class="n">wij</span> <span class="k">for</span> <span class="n">wij</span> <span class="ow">in</span> <span class="n">wijs</span><span class="p">]))</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wij</span> <span class="o">/</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">wij</span> <span class="ow">in</span> <span class="n">wijs</span><span class="p">]</span>
                    <span class="n">big_q</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">nq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">/</span> <span class="n">big_q</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
                    <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="o">*</span> <span class="n">nq</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;O&quot;</span><span class="p">:</span>
                <span class="c1"># put weights back to original transformation</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">original</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;unsupported weights transformation&quot;</span><span class="p">)</span></div>


    <span class="n">transform</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_transform</span><span class="p">,</span> <span class="n">set_transform</span><span class="p">)</span>

<div class="viewcode-block" id="W.asymmetry">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.asymmetry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">asymmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intrinsic</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asymmetry check.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        intrinsic : bool</span>
<span class="sd">            Default is ``True``. Intrinsic symmetry is defined as:</span>

<span class="sd">            .. math::</span>

<span class="sd">                w_{i,j} == w_{j,i}</span>

<span class="sd">            If ``intrinsic`` is ``False`` symmetry is defined as:</span>

<span class="sd">            .. math::</span>

<span class="sd">                i \in N_j \ \&amp; \ j \in N_i</span>

<span class="sd">            where :math:`N_j` is the set of neighbors for :math:`j`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        asymmetries : list</span>
<span class="sd">            Empty if no asymmetries are found. If there are asymmetries,</span>
<span class="sd">            then a ``list`` of ``(i,j)`` tuples is returned sorted in</span>
<span class="sd">            ascending *index location* order.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import lat2W</span>
<span class="sd">        &gt;&gt;&gt; w=lat2W(3,3)</span>
<span class="sd">        &gt;&gt;&gt; w.asymmetry()</span>
<span class="sd">        []</span>
<span class="sd">        &gt;&gt;&gt; w.transform=&#39;r&#39;</span>
<span class="sd">        &gt;&gt;&gt; w.asymmetry()</span>
<span class="sd">        [(0, 1), (0, 3), (1, 0), (1, 2), (1, 4), (2, 1), (2, 5), (3, 0), (3, 4), (3, 6), (4, 1), (4, 3), (4, 5), (4, 7), (5, 2), (5, 4), (5, 8), (6, 3), (6, 7), (7, 4), (7, 6), (7, 8), (8, 5), (8, 7)]</span>
<span class="sd">        &gt;&gt;&gt; result = w.asymmetry(intrinsic=False)</span>
<span class="sd">        &gt;&gt;&gt; result</span>
<span class="sd">        []</span>
<span class="sd">        &gt;&gt;&gt; neighbors={0:[1,2,3], 1:[1,2,3], 2:[0,1], 3:[0,1]}</span>
<span class="sd">        &gt;&gt;&gt; weights={0:[1,1,1], 1:[1,1,1], 2:[1,1], 3:[1,1]}</span>
<span class="sd">        &gt;&gt;&gt; w=W(neighbors,weights)</span>
<span class="sd">        &gt;&gt;&gt; w.asymmetry()</span>
<span class="sd">        [(0, 1), (1, 0)]</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>

        <span class="k">if</span> <span class="n">intrinsic</span><span class="p">:</span>
            <span class="n">wd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
            <span class="n">wd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">wd</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ijs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ids</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">ijs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="n">i2id</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id2i</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">ijs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i2id</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i2id</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ijs</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">ijs</span></div>


<div class="viewcode-block" id="W.symmetrize">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.symmetrize">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">symmetrize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a symmetric KNN weight. This ensures that the neighbors</span>
<span class="sd">        of each focal observation consider the focal observation itself as</span>
<span class="sd">        a neighbor. This returns a generic ``W`` object, since the object is no</span>
<span class="sd">        longer guaranteed to have ``k`` neighbors for each observation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="n">neighbors</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">)</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
            <span class="n">out_w</span> <span class="o">=</span> <span class="n">W</span><span class="p">(</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">id_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id_order</span><span class="p">)</span>
            <span class="n">out_w</span><span class="o">.</span><span class="n">symmetrize</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out_w</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">focal</span><span class="p">,</span> <span class="n">fneighbs</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fneighbs</span><span class="p">):</span>
                    <span class="n">neighb_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">neighbor</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">focal</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">neighb_neighbors</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">neighbor</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">focal</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">neighbor</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">focal</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">return</span></div>


<div class="viewcode-block" id="W.full">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.full">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">full</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a full ``numpy.ndarray``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : libpysal.weights.W</span>
<span class="sd">            spatial weights object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (fullw, keys) : tuple</span>
<span class="sd">            The first element being the full ``numpy.ndarray`` and second</span>
<span class="sd">            element keys being the ids associated with each row in the array.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import W, full</span>
<span class="sd">        &gt;&gt;&gt; neighbors = {</span>
<span class="sd">        ...     &#39;first&#39;:[&#39;second&#39;],&#39;second&#39;:[&#39;first&#39;,&#39;third&#39;],&#39;third&#39;:[&#39;second&#39;]</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; weights = {&#39;first&#39;:[1],&#39;second&#39;:[1,1],&#39;third&#39;:[1]}</span>
<span class="sd">        &gt;&gt;&gt; w = W(neighbors, weights)</span>
<span class="sd">        &gt;&gt;&gt; wf, ids = full(w)</span>
<span class="sd">        &gt;&gt;&gt; wf</span>
<span class="sd">        array([[0., 1., 0.],</span>
<span class="sd">               [1., 0., 1.],</span>
<span class="sd">               [0., 1., 0.]])</span>
<span class="sd">        &gt;&gt;&gt; ids</span>
<span class="sd">        [&#39;first&#39;, &#39;second&#39;, &#39;third&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wfull</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_order</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_order</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">wfull</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span></div>


<div class="viewcode-block" id="W.to_WSP">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.to_WSP">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_WSP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a ``WSP`` object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        implicit : libpysal.weights.WSP</span>
<span class="sd">            Thin ``W`` class</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import W, WSP</span>
<span class="sd">        &gt;&gt;&gt; neighbors={&#39;first&#39;:[&#39;second&#39;],&#39;second&#39;:[&#39;first&#39;,&#39;third&#39;],&#39;third&#39;:[&#39;second&#39;]}</span>
<span class="sd">        &gt;&gt;&gt; weights={&#39;first&#39;:[1],&#39;second&#39;:[1,1],&#39;third&#39;:[1]}</span>
<span class="sd">        &gt;&gt;&gt; w=W(neighbors,weights)</span>
<span class="sd">        &gt;&gt;&gt; wsp=w.to_WSP()</span>
<span class="sd">        &gt;&gt;&gt; isinstance(wsp, WSP)</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; wsp.n</span>
<span class="sd">        3</span>
<span class="sd">        &gt;&gt;&gt; wsp.s0</span>
<span class="sd">        4</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        WSP</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">WSP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span><span class="p">)</span></div>


<div class="viewcode-block" id="W.set_shapefile">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.set_shapefile">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_shapefile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapefile</span><span class="p">,</span> <span class="n">idVariable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adding metadata for writing headers of ``.gal`` and ``.gwt`` files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        shapefile : str</span>
<span class="sd">            The shapefile name used to construct weights.</span>
<span class="sd">        idVariable : str</span>
<span class="sd">            The name of the attribute in the shapefile to associate</span>
<span class="sd">            with ids in the weights.</span>
<span class="sd">        full : bool</span>
<span class="sd">            Write out the entire path for a shapefile (``True``) or</span>
<span class="sd">            only the base of the shapefile without extension (``False``).</span>
<span class="sd">            Default is ``True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shpName</span> <span class="o">=</span> <span class="n">shapefile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shpName</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">shapefile</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_varName</span> <span class="o">=</span> <span class="n">idVariable</span></div>


<div class="viewcode-block" id="W.plot">
<a class="viewcode-back" href="../../../generated/libpysal.weights.W.html#libpysal.weights.W.plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">indexed_on</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">node_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge_kws</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot spatial weights objects. **Requires** ``matplotlib``, and</span>
<span class="sd">        implicitly requires a ``geopandas.GeoDataFrame`` as input.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gdf : geopandas.GeoDataFrame</span>
<span class="sd">            The original shapes whose topological relations are modelled in ``W``.</span>
<span class="sd">        indexed_on : str</span>
<span class="sd">            Column of ``geopandas.GeoDataFrame`` that the weights object uses</span>
<span class="sd">            as an index. Default is ``None``, so the index of the</span>
<span class="sd">            ``geopandas.GeoDataFrame`` is used.</span>
<span class="sd">        ax : matplotlib.axes.Axes</span>
<span class="sd">            Axis on which to plot the weights. Default is ``None``, so</span>
<span class="sd">            plots on the current figure.</span>
<span class="sd">        color : str</span>
<span class="sd">            ``matplotlib`` color string, will color both nodes and edges</span>
<span class="sd">            the same by default.</span>
<span class="sd">        node_kws : dict</span>
<span class="sd">            Keyword arguments dictionary to send to ``pyplot.scatter``,</span>
<span class="sd">            which provides fine-grained control over the aesthetics</span>
<span class="sd">            of the nodes in the plot.</span>
<span class="sd">        edge_kws : dict</span>
<span class="sd">            Keyword arguments dictionary to send to ``pyplot.plot``,</span>
<span class="sd">            which provides fine-grained control over the aesthetics</span>
<span class="sd">            of the edges in the plot.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        f : matplotlib.figure.Figure</span>
<span class="sd">            Figure on which the plot is made.</span>
<span class="sd">        ax : matplotlib.axes.Axes</span>
<span class="sd">            Axis on which the plot is made.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If you&#39;d like to overlay the actual shapes from the</span>
<span class="sd">        ``geopandas.GeoDataFrame``, call ``gdf.plot(ax=ax)`` after this.</span>
<span class="sd">        To plot underneath, adjust the z-order of the plot as follows:</span>
<span class="sd">        ``gdf.plot(ax=ax,zorder=0)``.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import Queen</span>
<span class="sd">        &gt;&gt;&gt; import libpysal as lp</span>
<span class="sd">        &gt;&gt;&gt; import geopandas</span>
<span class="sd">        &gt;&gt;&gt; gdf = geopandas.read_file(lp.examples.get_path(&quot;columbus.shp&quot;))</span>
<span class="sd">        &gt;&gt;&gt; weights = Queen.from_dataframe(gdf)</span>
<span class="sd">        &gt;&gt;&gt; tmp = weights.plot(</span>
<span class="sd">        ...     gdf, color=&#39;firebrickred&#39;, node_kws=dict(marker=&#39;*&#39;, color=&#39;k&#39;)</span>
<span class="sd">        ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;W.plot depends on matplotlib.pyplot, and this was&quot;</span>
                <span class="s2">&quot;not able to be imported. </span><span class="se">\n</span><span class="s2">Install matplotlib to&quot;</span>
                <span class="s2">&quot;plot spatial weights.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">node_kws</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;color&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_kws</span><span class="p">:</span>
                <span class="n">node_kws</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">color</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">edge_kws</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;color&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edge_kws</span><span class="p">:</span>
                <span class="n">edge_kws</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edge_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">color</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">neighbors</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">islands</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">indexed_on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">neighbors</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="n">indexed_on</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="n">indexed_on</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">neighbors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span>
            <span class="n">centroids</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">neighbors</span><span class="p">]</span><span class="o">.</span><span class="n">centroid</span>
            <span class="n">centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">centroids</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">centroids</span><span class="o">.</span><span class="n">y</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">focal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
            <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">nidx</span><span class="p">,</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">centroids</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">nidx</span><span class="p">)</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">focal</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">edge_kws</span>
                <span class="p">)</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">idx</span><span class="p">,</span> <span class="n">nidx</span><span class="p">))</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">nidx</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span>
        <span class="n">centroids</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">centroid</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">centroids</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">centroids</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">node_kws</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span></div>
</div>



<div class="viewcode-block" id="WSP">
<a class="viewcode-back" href="../../../generated/libpysal.weights.WSP.html#libpysal.weights.WSP">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">WSP</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Thin ``W`` class for ``spreg``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sparse : scipy.sparse.{matrix-type}</span>
<span class="sd">        NxN object from ``scipy.sparse``</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    n           : int</span>
<span class="sd">                  description</span>
<span class="sd">    s0          : float</span>
<span class="sd">                  description</span>
<span class="sd">    trcWtW_WW   : float</span>
<span class="sd">                  description</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    From GAL information</span>

<span class="sd">    &gt;&gt;&gt; import scipy.sparse</span>
<span class="sd">    &gt;&gt;&gt; from libpysal.weights import WSP</span>
<span class="sd">    &gt;&gt;&gt; rows = [0, 1, 1, 2, 2, 3]</span>
<span class="sd">    &gt;&gt;&gt; cols = [1, 0, 2, 1, 3, 3]</span>
<span class="sd">    &gt;&gt;&gt; weights =  [1, 0.75, 0.25, 0.9, 0.1, 1]</span>
<span class="sd">    &gt;&gt;&gt; sparse = scipy.sparse.csr_matrix((weights, (rows, cols)), shape=(4,4))</span>
<span class="sd">    &gt;&gt;&gt; w = WSP(sparse)</span>
<span class="sd">    &gt;&gt;&gt; w.s0</span>
<span class="sd">    4.0</span>
<span class="sd">    &gt;&gt;&gt; w.trcWtW_WW</span>
<span class="sd">    6.395</span>
<span class="sd">    &gt;&gt;&gt; w.n</span>
<span class="sd">    4</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="WSP.__init__">
<a class="viewcode-back" href="../../../generated/libpysal.weights.WSP.html#libpysal.weights.WSP.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sparse</span><span class="p">,</span> <span class="n">id_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">issparse</span><span class="p">(</span><span class="n">sparse</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must pass a scipy sparse object&quot;</span><span class="p">)</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="o">!=</span> <span class="n">cols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Weights object must be square&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">id_order</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_order</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Number of values in id_order must match shape of sparse&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span> <span class="o">=</span> <span class="n">id_order</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;id_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span>
        <span class="c1"># temp addition of index attribute</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>  <span class="c1"># will be removed after refactoring is done</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;index must be an instance of pandas.Index dtype&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of values in index must match shape of sparse&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">id_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;An ordered list of ids, assumed to match the ordering in ``sparse``.&quot;&quot;&quot;</span>
        <span class="c1"># Temporary solution until the refactoring is finished</span>
        <span class="k">if</span> <span class="s2">&quot;id_order&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;id_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_order</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;``s0`` is defined as:</span>

<span class="sd">        .. math::</span>

<span class="sd">               s0=\sum_i \sum_j w_{i,j}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;s0&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;s0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s0</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">trcWtW_WW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trace of :math:`W^{&#39;}W + WW`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;trcWtW_WW&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trcWtW_WW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diagWtW_WW</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;trcWtW_WW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trcWtW_WW</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trcWtW_WW</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">diagWtW_WW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Diagonal of :math:`W^{&#39;}W + WW`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;diagWtW_WW&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="n">wt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_diagWtW_WW</span> <span class="o">=</span> <span class="p">(</span><span class="n">wt</span> <span class="o">@</span> <span class="n">w</span> <span class="o">+</span> <span class="n">w</span> <span class="o">@</span> <span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;diagWtW_WW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diagWtW_WW</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diagWtW_WW</span>

<div class="viewcode-block" id="WSP.from_W">
<a class="viewcode-back" href="../../../generated/libpysal.weights.WSP.html#libpysal.weights.WSP.from_W">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_W</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs a ``WSP`` object from the ``W``&#39;s sparse matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        W : libpysal.weights.W</span>
<span class="sd">            A PySAL weights object with a sparse form and ids.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A ``WSP`` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">sparse</span><span class="p">,</span> <span class="n">id_order</span><span class="o">=</span><span class="n">W</span><span class="o">.</span><span class="n">id_order</span><span class="p">)</span></div>


<div class="viewcode-block" id="WSP.to_W">
<a class="viewcode-back" href="../../../generated/libpysal.weights.WSP.html#libpysal.weights.WSP.to_W">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_W</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">silence_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a pysal WSP object (thin weights matrix) to a pysal W object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : WSP</span>
<span class="sd">            PySAL sparse weights object.</span>
<span class="sd">        silence_warnings : bool</span>
<span class="sd">            Switch to ``True`` to turn off print statements for every</span>
<span class="sd">            observation with islands. Default is ``False``, which does</span>
<span class="sd">            not silence warnings.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        w : W</span>
<span class="sd">            PySAL weights object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from libpysal.weights import lat2SW, WSP, WSP2W</span>

<span class="sd">        Build a 10x10 ``scipy.sparse`` matrix for a rectangular 2x5</span>
<span class="sd">        region of cells (rook contiguity), then construct a ``libpysal``</span>
<span class="sd">        sparse weights object (``self``).</span>

<span class="sd">        &gt;&gt;&gt; sp = lat2SW(2, 5)</span>
<span class="sd">        &gt;&gt;&gt; self = WSP(sp)</span>
<span class="sd">        &gt;&gt;&gt; self.n</span>
<span class="sd">        10</span>
<span class="sd">        &gt;&gt;&gt; print(self.sparse[0].todense())</span>
<span class="sd">        [[0 1 0 0 0 1 0 0 0 0]]</span>

<span class="sd">        Convert this sparse weights object to a standard PySAL weights object.</span>

<span class="sd">        &gt;&gt;&gt; w = WSP2W(self)</span>
<span class="sd">        &gt;&gt;&gt; w.n</span>
<span class="sd">        10</span>
<span class="sd">        &gt;&gt;&gt; print(w.full()[0][0])</span>
<span class="sd">        [0. 1. 0. 0. 0. 1. 0. 0. 0. 0.]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">indptr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">indptr</span><span class="p">)</span>
        <span class="n">id_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_order</span>
        <span class="k">if</span> <span class="n">id_order</span><span class="p">:</span>
            <span class="c1"># replace indices with user IDs</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_order</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">id_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="n">neighbors</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">indptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="n">oid</span> <span class="o">=</span> <span class="n">id_order</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">indptr</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">neighbors</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="n">weights</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">end</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_order</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">W</span><span class="p">(</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">silence_warnings</span><span class="o">=</span><span class="n">silence_warnings</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">_sparse</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;sparse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">_sparse</span>
        <span class="k">return</span> <span class="n">w</span></div>
</div>

</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2018-, pysal developers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 8.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>